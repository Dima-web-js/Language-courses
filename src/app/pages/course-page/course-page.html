@if (loading()) {
  <div class="loading-wrapper">
    <mat-spinner diameter="48"></mat-spinner>
    <p transloco="Загрузка курса..."></p>
  </div>
} @else if (course(); as courseData) {
  <div class="course-container">
    <button mat-raised-button (click)="goBack()" class="back-button">
      ← <ng-container transloco="Назад к списку курсов"></ng-container>
    </button>

    <mat-card class="course-header">
      <mat-card-header>
        <mat-card-title>{{ courseData.name }}</mat-card-title>
        <mat-card-subtitle><ng-container transloco="Автор"></ng-container>: {{ courseData.author }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="course-meta">
          <mat-chip-set>
            <mat-chip>{{ courseData.level }}</mat-chip>
            <mat-chip>{{ (courseData.category === 'adults' ? 'Для взрослых' : 'Для детей') | transloco }}</mat-chip>
            <mat-chip>{{ courseData.theme }}</mat-chip>
            <mat-chip>{{ courseData.language }}</mat-chip>
            <mat-chip>⭐ {{ courseData.rate }}/5</mat-chip>
          </mat-chip-set>
        </div>

        <h3 transloco="Описание курса"></h3>
        <p>{{ courseData.description }}</p>

        <h3 transloco="Цели курса"></h3>
        <ul class="goals-list">
          @for (goal of courseData.goals; track goal) {
            <li>{{ goal }}</li>
          }
        </ul>

        <h3 transloco="Программа"></h3>
        <p>{{ courseData.program }}</p>
      </mat-card-content>
    </mat-card>

    <mat-card class="lessons-card">
      <mat-card-header>
        <mat-card-title transloco="Уроки курса"></mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <table mat-table [dataSource]="courseData.lessons" class="mat-elevation-z8 lessons-table">
          <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef transloco="Название урока"></th>
            <td mat-cell *matCellDef="let lesson">{{ lesson.title }}</td>
          </ng-container>
          <ng-container matColumnDef="duration">
            <th mat-header-cell *matHeaderCellDef transloco="Длительность"></th>
            <td mat-cell *matCellDef="let lesson">{{ lesson.duration }} <ng-container transloco="мин"></ng-container></td>
          </ng-container>
          <ng-container matColumnDef="progress">
            <th mat-header-cell *matHeaderCellDef transloco="Прогресс"></th>
            <td mat-cell *matCellDef="let lesson">
              @if (lesson.progress !== undefined) {
                <div class="progress-cell">
                  <span class="progress-text">{{ lesson.progress }}%</span>
                  <mat-progress-bar
                    mode="determinate"
                    [value]="lesson.progress"
                  ></mat-progress-bar>
                </div>
              } @else {
                —
              }
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="lessonsDisplayedColumns"></tr>
          <tr
            mat-row
            *matRowDef="let lesson; columns: lessonsDisplayedColumns;"
            (click)="openLesson(courseData.id, lesson.id)"
            class="clickable-row"
          ></tr>
        </table>
      </mat-card-content>
    </mat-card>
  </div>
} @else {
  <div class="error-container">
    <p transloco="Курс не найден"></p>
    <button mat-raised-button (click)="goBack()" transloco="Назад к списку курсов"></button>
  </div>
}
